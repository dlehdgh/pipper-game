class Ai{constructor(){this.tile=new Array,this.prev=new Tile(pipper.prev).info(),this.prev.value=pipper.prev[0]?pipper.prev[0]:0,this.bomb=new Tile(tile[pipper.priority]).count(),this.single=this.bomb.fillmap(1,this.prev.value),this.pair=this.bomb.fillmap(2,this.prev.value),this.min=Math.min.apply(null,tile.map(i=>i.filter(i=>i>=0).length).filter((i,t)=>t!=pipper.priority)),this.count=this.bomb[15],this.x=16}abandon(){if(pipper.priority==pipper.last&&(this.prev={type:-1,name:null,value:0},this.single=this.bomb.fillmap(1,0),this.pair=this.bomb.fillmap(2,0),console.log(`${person[pipper.priority]}님이 선입니다.`)),(this.min<6||4==this.prev.type||5==this.prev.type)&&pipper.last!=pipper.priority&&(1==this.bomb.includes(3)&&5!=this.prev.type?4==this.prev.type?this.tile=new Array(3).fill(this.bomb.fillmap(3,this.prev.value)[0]).filter(i=>i):this.tile=new Array(3).fill(this.bomb.fillmap(3,0)[0]).filter(i=>i):1==this.bomb.includes(4)&&(5==this.prev.type?this.tile=new Array(4).fill(this.bomb.fillmap(4,this.prev.value)[0]).filter(i=>i):this.tile=new Array(4).fill(this.bomb.fillmap(4,0)[0]).filter(i=>i))),0==this.tile.length&&this.prev.type<4)switch(this.prev.type){case 3:this.tile=this.isPairStraight(pipper.prev.length);break;case 2:this.tile=this.isStraight(pipper.prev.length);break;case 1:this.tile=this.isPair();break;case 0:this.tile=this.isSingle();break;default:let i=new Array;i.push(this.isPairStraight()),i.push(this.isStraight()),i.push(this.isPair()),i.push(this.isSingle()),i=i.filter(i=>i.length>0),i.length>0&&(this.tile=i[0])}if(this.tile.length>0){let i=tile[pipper.priority];pipper.last=pipper.priority,pipper.prev=this.tile,this.tile=this.tile.map((t,e)=>{let h=i.indexOf(t);return delete i[h],new Object({index:h,value:t})})}new Map(this.tile).print()}isPairStraight(i){let t=new Array,e=this.toStraight(2);if(e=0==!i?e.filter(t=>t.length>=i):e.filter(i=>i.length>=6),e.length>0)t=this.min<6?e[e.length-1]:e[0];else if(this.min<9&&this.count>0&&this.single.length>0&&this.pair.length>0){let e=new Array;this.pair.reduce((i,h,s)=>(h-i<=2&&(e.filter(t=>t==i).length<2&&e.push(i,i),h-i==2&&(1==this.single.includes(i+1)?e.push(i+1,this.x):e=new Array),e.push(h,h)),h-i>2&&(e.length>5&&1==e.includes(this.x)&&t.push(e),e=new Array,e.push(h,h)),h)),e.length>5&&t.push(e),$.each(t,(e,h)=>0==!i?(h=h.filter(i=>i>this.prev.value),h.length>=i&&h.xlength()<=this.count?(t=h.slice(0,i),this.count-=t.xlength(),!1):(t=h.slice(0,h.map((i,t)=>i==this.x?t:null).filter(i=>i)[this.count]-1),this.count-=t.xlength(),!1)):h.xlength()<=this.count?(t=h,this.count-=t.xlength(),!1):(t=h.slice(0,h.map((i,t)=>i==this.x?t:null).filter(i=>i)[this.count]-1),this.count-=t.xlength(),!1)),0==t.includes(this.x)&&(t=new Array)}let h=new Tile(t).info();return 0==!i?((-1==h.type||t.length<i)&&(t=new Array),pipper.prev.length>0&&t.length>i&&(t=t.splice(0,i))):(-1==h.type||t.length<6)&&(t=new Array),t}isStraight(i){let t=new Array,e=this.toStraight(1);if(e=0==!i?e.filter(t=>t.length>=i):e.filter(i=>i.length>=3),e.length>0)t=this.min<6?e[e.length-1]:e[0];else if(this.min<9&&this.count>0&&this.single.length>0){let e=new Array;this.single.reduce((i,h,s)=>(h-i<=2&&(0==e.includes(i)&&e.push(i),h-i==2&&e.push(this.x),e.push(h)),h-i>2&&(e.length>2&&1==e.includes(this.x)&&t.push(e),e=new Array,e.push(h)),h)),e.length>2&&t.push(e),$.each(t,(e,h)=>0==!i?(h=h.filter(i=>i>this.prev.value).filter((i,t)=>!(0==t&&i==this.x)),h.length>=i&&h.xlength()<=this.count?(t=h.slice(0,i),this.count-=t.xlength(),!1):(t=h.slice(0,h.map((i,t)=>i==this.x?t:null).filter(i=>i)[this.count]),this.count-=t.xlength(),!1)):h.xlength()<=this.count?(t=h,this.count-=t.xlength(),!1):(t=h.slice(0,h.map((i,t)=>i==this.x?t:null).filter(i=>i)[this.count]),this.count-=t.xlength(),!1)),0==t.includes(this.x)&&(t=new Array)}let h=new Tile(t).info();return 0==!i?((-1==h.type||t.length<i)&&(t=new Array),pipper.prev.length>0&&t.length>i&&(t=t.splice(0,i))):(-1==h.type||t.length<3)&&(t=new Array),t}isPair(){let i=new Array;if(this.single=this.single.filter(i=>i!=this.x),this.pair.length>0)if(this.min<6){let t=this.pair[this.pair.length-1];i.push(t,t)}else i.push(this.pair[0],this.pair[0]);else if(this.count>0&&this.single.length>0)if(this.min<6){let t=this.single.slice(-1)[0];1==!t&&i.push(t,this.x)}else i.push(this.single[0],this.x);return i}isSingle(){let i=new Array;return this.min>8&&(this.single=this.single.filter(i=>i!=this.x)),this.single.length>0&&(this.min<6?i.push(this.single.slice(-1)[0]):i.push(this.single[0])),i}toStraight(i){let t=new Array,e=new Array;return $.each(this.bomb,(h,s)=>{s==i&&this.prev.value<h+1?e=e.concat(new Array(i).fill(h+1)):e.length>0&&(t.push(e),e=new Array)}),e.length>0&&t.push(e),t}}